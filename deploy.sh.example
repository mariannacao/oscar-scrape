#!/bin/bash

SERVER="your-username@your-server-ip"
PORT="your-ssh-port"

ssh -t -p $PORT $SERVER "mkdir -p ~/oscar-scraper"

scp -P $PORT oscar_scraper.py $SERVER:~/oscar-scraper/
scp -P $PORT requirements.txt $SERVER:~/oscar-scraper/
scp -P $PORT .env $SERVER:~/oscar-scraper/
scp -P $PORT test_notification.py $SERVER:~/oscar-scraper/
scp -P $PORT supervisor.sh $SERVER:~/oscar-scraper/

cat > setup.sh << 'EOF'
#!/bin/bash
cd ~/oscar-scraper

python3 -m pip install --upgrade pip

python3 -m venv venv
source venv/bin/activate

pip install requests==2.27.1
pip install beautifulsoup4==4.9.3
pip install python-dotenv==0.19.0

python test_notification.py

chmod +x supervisor.sh

pkill -f oscar_scraper.py

nohup ./supervisor.sh > supervisor.log 2>&1 &

ps aux | grep supervisor.sh
EOF

scp -P $PORT setup.sh $SERVER:~/oscar-scraper/
ssh -t -p $PORT $SERVER "chmod +x ~/oscar-scraper/setup.sh"
ssh -t -p $PORT $SERVER "cd ~/oscar-scraper && ./setup.sh"

rm setup.sh 